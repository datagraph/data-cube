!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.qa=e()}(this,function(){"use strict";var t;return function(t){(()=>{const{assert:e,addArrayMethod:r,polarize:n,toArray:o,def:s,callUpdate:l,ensureKey:i,ensureLabel:a,copyMap:h}=Array.prototype._helper,c=t=>document.createElement(t),f=t=>document.createElementNS("http://www.w3.org/2000/svg",t);if("me"in Event.prototype)throw Error(name+" is already a property of Event.protoype");Object.defineProperty(Event.prototype,"me",{get(){return[this.target]}});const u=t=>[...document.querySelectorAll(e.single(t))];r("qa",function(t){t=e.single(t);const r=this.length,n=[];let o=0,s=0;for(let e=0;e<r;e++){let r=this[e].querySelectorAll(t),l=r.length;o+=l,n.length=o;for(let t=0;t<l;t++)n[s++]=r[t]}return n});{const t=(t,e,r,o,s)=>{const l=t.length;var[e,i]=n(e),[r,a]=n(r),[o,h]=n(o);if(!i&&e.length!==l||!a&&r.length!==l||!h&&o.length!==l)throw Error("shape mismatch");!a||void 0!==r&&null!==r||(r=1);const u=e=>{const r=h?o:o[e];return void 0===r||"end"===r?null:"start"===r?t[e].firstChild:r},d=s?f:c,g=n=>{const o=i?e:e[n];if("string"==typeof o){const t=(t=>a?r:r[t])(n),e=new Array(t);for(let r=0;r<t;r++)e[r]=d(o);return e}return"function"==typeof o?o(t[n],n,t):o},p=[];let y=0;for(let e=0;e<l;e++){let r=u(e),n=g(e);if(Array.isArray(n)){let o=n.length;p.length+=o;for(let s=0;s<o;s++)t[e].insertBefore(n[s],r),p[y++]=n[s]}else t[e].insertBefore(n,r),p[y++]=n}return p};r("insert",function(e,r,n){return t(this,e,r,n,!1)}),r("insertSVG",function(e,r,n){return t(this,e,r,n,!0)})}{const t=(t,r,n)=>{const l=(t=o(t)).length;r=s(e.single(r),1);const i=n?f:c,a=new Array(l*r);let h=0;for(let e=0;e<r;e++)for(let e=0;e<l;e++)a[h++]=i(t[e]);return a};u.create=((e,r)=>t(e,r,!1)),u.createSVG=((e,r)=>t(e,r,!0)),u.fragment=(t=>{t=s(e.single(t),1);const r=new Array(t);for(let e=0;e<t;e++)r[e]=document.createDocumentFragment();return r})}{const t=(t,r,n,s)=>{if(r=o(r),1!==t.length)throw Error("1-entry array expected");const l=/^([_a-zA-Z0-9-]+)((?:\.-?[_a-zA-Z]+[_a-zA-Z0-9-]*)*)$/,c=Math.min(s.length,4),f=new Array(c),d=new Array(c);for(let t=0;t<c;t++){let r=e.single(s[t]);if(r){const e=(r=""+r).match(l);if(!e)throw Error(`invalid argument, ${r.slice(0,20)+(r.length>20?" ...":"")}`);f[t]=e[1],e[2]&&(d[t]=e[2].replace(/\./g," ").trim())}}const g=(t,e,r)=>{e._data_cube&&(e._k&&e._k[t]&&(i(r),r._k[t]=h(e._k[t])),e._l&&e._l[t]&&(a(r),r._l[t]=e._l[t]))},[p,y,m]=r._data_cube?r.shape():[r.length,1,1],A=[null,null,null,null],v=u.fragment();let w=v;if(f[0]&&(g(0,r,w=w[n](f[0],p).toCube()),d[0]&&w.$attr("class",d[0]),A[0]=w),f[1]&&(w=w[n](f[1],y),f[0]&&(w=w.$shape([y,p,1])),w=w.tp(),f[0]&&g(0,r,w),g(1,r,w),d[1]&&w.$attr("class",d[1]),A[1]=w),f[2]&&(w=w[n](f[2],m),f[0]&&f[1]?(g(0,r,w=w.$shape([m,p,y]).tp([1,2,0])),g(1,r,w)):f[0]?g(0,r,w=w.$shape([m,p,1]).tp([1,2,0])):f[1]?g(1,r,w=w.$shape([m,y,1]).tp([2,1,0])):w=w.tp([1,2,0]),g(2,r,w),d[2]&&w.$attr("class",d[2]),A[2]=w),f[3]){if(w.length!==r.length)throw Error("encoding inner arrays, must also encode all 'outer' dimensions that do not have length 1");const t=w.copy("shell");for(let e=0,o=r.length;e<o;e++){const o=r[e];if(!Array.isArray(o))throw Error("inner array expected");if(o._data_cube&&(1!==o._s[1]||1!==o._s[2]))throw Error("inner arrays must have 1 column and 1 page");t[e]=w[e][n](f[3],o.length).toCube(),g(0,o,t[e]),d[3]&&t[e].$attr("class",d[3])}A[3]=t}return t[n](v),A};r("encode",function(e,...r){return t(this,e,"insert",r)}),r("encodeSVG",function(e,...r){return t(this,e,"insertSVG",r)})}r("remove",function(){for(let t=0,e=this.length;t<e;t++)this[t].parentNode.removeChild(this[t]);return this}),r("raise",function(){for(let t=0,e=this.length;t<e;t++)this[t].parentNode.insertBefore(this[t],null);return this}),r("lower",function(){for(let t=0,e=this.length;t<e;t++){let e=this[t].parentNode;e.insertBefore(this[t],e.firstChild)}return this}),r("children",function(){const t=this.length;k=0;for(let e=0;e<t;e++){let t=this[e].children,r=t.length;newElm.length+=r;for(let e=0;e<r;e++)newElm[k++]=t[e]}return[]}),["firstChild","lastChild","parent"].forEach(t=>{r(t,function(){"parent"===t&&(t="parentNode");const e=this.length,r=new Array(e);for(let n=0;n<e;n++)r[n]=this[n][t];return r})});{const t=(t,r,n)=>{n=e.single(n);const o=t.length,s=new Array(o);if("style"===r)for(let e=0;e<o;e++)s[e]=window.getComputedStyle(t[e])[n];else if("attr"===r)for(let e=0;e<o;e++)s[e]=t[e].getAttribute(n);else if("hasAttr"===r)for(let e=0;e<o;e++)s[e]=t[e].hasAttribute(n);else for(let e=0;e<o;e++)s[e]=t[e].classList.contains(n);return s};["style","attr","hasAttr","hasClass"].forEach(e=>{r(e,function(r){return t(this,e,r)})})}{const t=(t,r,o,s)=>{const i=o,a=s;t._b&&l(t,"_b",r,[i,a]),o=e.single(o);var[s,h]=n(s);const c=t.length;if(h)if("$style"===r)for(let e=0;e<c;e++)t[e].style[o]=s;else for(let e=0;e<c;e++)t[e].setAttribute(o,s);else{if(s.length!==c)throw Error("shape mismatch");if("$style"===r)for(let e=0;e<c;e++)t[e].style[o]=s[e];else for(let e=0;e<c;e++)t[e].setAttribute(o,s[e])}return t._a&&l(t,"_a",r,[i,a]),t};["$style","$attr"].forEach(e=>{r(e,function(r,n){return t(this,e,r,n)})}),["style","attr"].forEach(t=>{r("$$"+t,function(r,n){e.single(r),n=e.single(n);const o=this.length,s=new Array(o);for(let t=0;t<o;t++)s[t]=n(this[t],this);return this["$"+t](r,s),this})})}{const t=(t,e,r,o,s)=>{const l=t=>{var[t,e]=n(t);if(e)return()=>t;if(t.length!==i)throw Error("shape mismatch");return e=>t[e]},i=t.length,a=l(r);if("on"===e||"off"===e){const r=l(o),n=l(s),h="on"===e?"addEventListener":"removeEventListener";for(let e=0;e<i;e++)t[e][h](a(e),r(e),n(e))}else if("removeAttr"===e)for(let e=0;e<i;e++)t[e].removeAttribute(a(e));else if("addClass"===e)for(let e=0;e<i;e++)t[e].classList.add(a(e));else if("removeClass"===e)for(let e=0;e<i;e++)t[e].classList.remove(a(e));return t};["removeAttr","addClass","removeClass","on","off"].forEach(e=>{r(e,function(r,n,o){return t(this,e,r,n,o)})})}r("sketch",function(t,r){t=e.single(t),r=e.single(r);const n=this.length?this.slice(0,1).insert("canvas"):u.create("canvas"),o=n[0];void 0!==t&&o.setAttribute("width",t),void 0!==r&&o.setAttribute("height",r);const s=o.getContext("2d");return s.loop=Array.prototype.loop.bind([s]),[n,s]}),t.exports=u})()}(t={exports:{}},t.exports),t.exports});
